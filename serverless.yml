service: qiita-lgtm-ranking

frameworkVersion: '2'

custom:
  prefix: ${self:service}-${self:provider.stage}
  schedule:
    enabled:
      dev: true # TODO: change to false

provider:
  name: aws
  region: us-east-1
  profile: default
  runtime: go1.x
  stage: ${opt:stage, "dev"}
  environment:
    QIITA_ACCESS_TOKEN: ${file(./secret.yml):qiitaAccessToken}

package:
  exclude:
    - ./**
  include:
    - ./build/**

functions:
  updateWeeklyPerTag:
    handler: build/updateWeeklyPerTag
    timeout: 900
    events:
      - schedule:
          name: ${self:custom.prefix}-aws
          rate: cron(0 1 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/aws.${self:provider.stage}.json)}
      - schedule:
          name: ${self:custom.prefix}-docker
          rate: cron(0 2 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/docker.${self:provider.stage}.json)}
      - schedule:
          name: ${self:custom.prefix}-ios
          rate: cron(0 3 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/ios.${self:provider.stage}.json)}
      - schedule:
          name: ${self:custom.prefix}-javascript
          rate: cron(0 4 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/javascript.${self:provider.stage}.json)}
      - schedule:
          name: ${self:custom.prefix}-php
          rate: cron(0 5 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/php.${self:provider.stage}.json)}
      - schedule:
          name: ${self:custom.prefix}-python
          rate: cron(0 6 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/python.${self:provider.stage}.json)}
      - schedule:
          name: ${self:custom.prefix}-rails
          rate: cron(0 6 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/rails.${self:provider.stage}.json)}
      - schedule:
          name: ${self:custom.prefix}-typescript
          rate: cron(0 7 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/typescript.${self:provider.stage}.json)}
