service: qiita-lgtm-ranking

frameworkVersion: '2'

custom:
  prefix: ${self:service}-${self:provider.stage}
  schedule:
    enabled:
      dev: false
      prod: true

provider:
  name: aws
  region: us-east-1
  profile: default
  runtime: go1.x
  memorySize: 256
  stage: ${opt:stage, "dev"}
  environment:
    QIITA_ACCESS_TOKEN: ${file(./secret.yml):qiitaAccessToken}

package:
  exclude:
    - ./**
  include:
    - ./build/**

functions:
  updateWeeklyPerTag:
    handler: build/updateWeeklyPerTag
    timeout: 900
    events:
      # AWS
      - schedule:
          name: ${self:custom.prefix}-aws
          rate: cron(0 1 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/aws.${self:provider.stage}.json)}

      # Docker
      - schedule:
          name: ${self:custom.prefix}-docker
          rate: cron(0 2 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/docker.${self:provider.stage}.json)}

      # iOS
      - schedule:
          name: ${self:custom.prefix}-ios
          rate: cron(0 3 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/ios.${self:provider.stage}.json)}

      # JavaScript
      - schedule:
          name: ${self:custom.prefix}-javascript
          rate: cron(0 4 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/javascript.${self:provider.stage}.json)}

      # PHP
      - schedule:
          name: ${self:custom.prefix}-php
          rate: cron(0 5 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/php.${self:provider.stage}.json)}

      # Python
      - schedule:
          name: ${self:custom.prefix}-python
          rate: cron(0 6 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/python.${self:provider.stage}.json)}

      # Rails
      - schedule:
          name: ${self:custom.prefix}-rails
          rate: cron(0 6 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/rails.${self:provider.stage}.json)}

      # Ruby
      - schedule:
          name: ${self:custom.prefix}-typescript
          rate: cron(0 7 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/typescript.${self:provider.stage}.json)}

      # Vim
      - schedule:
          name: ${self:custom.prefix}-vim
          rate: cron(0 8 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/vim.${self:provider.stage}.json)}

      # Vue.js
      - schedule:
          name: ${self:custom.prefix}-vuejs
          rate: cron(0 9 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/vuejs.${self:provider.stage}.json)}

      # Java
      - schedule:
          name: ${self:custom.prefix}-java
          rate: cron(0 10 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/java.${self:provider.stage}.json)}

      # Swift
      - schedule:
          name: ${self:custom.prefix}-swift
          rate: cron(0 11 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/swift.${self:provider.stage}.json)}

      # React
      - schedule:
          name: ${self:custom.prefix}-react
          rate: cron(0 12 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/react.${self:provider.stage}.json)}

      # Go
      - schedule:
          name: ${self:custom.prefix}-go
          rate: cron(0 13 * * ? *)
          enabled: ${self:custom.schedule.enabled.${self:provider.stage}}
          input: ${file(./events/updateWeeklyPerTag/go.${self:provider.stage}.json)}
